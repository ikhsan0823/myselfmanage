<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Self Manage Dashboard</title>
    <link rel="stylesheet" href="static/dashboard.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <div class="container">
        <div onmouseover="main()" onmouseout="hide()" class="sidebar">
            <i class="fa-solid fa-bars"></i>
            <div id="barList" class="sidebar-list">
                <a href="/dashboard"><div onmouseover="setColor7()" onmouseout="unsetColor7()" class="my-list">
                    <i id="color7" class="fa-solid fa-table-columns"></i>
                    <div>Dashboard</div>
                </div></a>
                <a href="/daily"><div onmouseover="setColor()" onmouseout="unsetColor()" class="my-list">
                    <i id="color" class="fa-solid fa-calendar-day"></i>
                    <div>My Daily</div>
                </div></a>
                <a href="/livechat"><div onmouseover="setColor1()" onmouseout="unsetColor1()" class="my-list">
                    <i id="color1" id="color" class="fa-solid fa-calendar-week"></i>
                    <div>My Weekly</div>
                </div></a>
                <div onmouseover="setColor2()" onmouseout="unsetColor2()" class="my-list">
                    <i id="color2" id="color" class="fa-solid fa-calendar-days"></i>
                    <div>My Monthly</div>
                </div>
                <a href="/money"><div onmouseover="setColor3()" onmouseout="unsetColor3()" class="my-list">
                    <i id="color3" id="color" class="fa-solid fa-wallet"></i>
                    <div>My Money</div>
                </div></a>
                <div onmouseover="setColor4()" onmouseout="unsetColor4()" class="my-list">
                    <i id="color4" id="color" class="fa-solid fa-gift"></i>
                    <div>My Reward</div>
                </div>
            </div>
            <div id="account-list" class="sidebar-account">
                <div onmouseover="setColor5()" onmouseout="unsetColor5()" class="my-list">
                    <i id="color5" id="color" class="fa-solid fa-gear"></i>
                    <div>Setting</div>
                </div>
                <div onclick="confirmLogout()" onmouseover="setColor6()" onmouseout="unsetColor6()" class="my-list">
                    <i id="color6" id="color" class="fa-solid fa-right-from-bracket"></i>
                    <div>Logout</div>
                </div>
            </div>
        </div>
        <div class="dashboard">
            <div class="header">
                <div class="greeting">
                    <div id="greeting-message" class="greeting-text"></div>
                    <div id="motivation-text" class="motivation-text"></div>
                </div>
                <div class="calendar">
                    <div id="day" class="calendar-day"></div>
                    <div id="date" class="calendar-date"></div>
                    <div id="month" class="calendar-month"></div>
                </div>
            </div>
            <div class="list">
                <div class="header-list">
                    <div>Dashboard</div>
                </div>
                <div class="content-list">
                    <div class="list-card">
                        <i class="fa-solid fa-calendar-day"></i>
                        <div>My Daily</div>
                    </div>
                    <div class="list-card">
                        <i class="fa-solid fa-calendar-week"></i>
                        <div>My Weekly</div>
                    </div>
                    <div class="list-card">
                        <i class="fa-solid fa-calendar-days"></i>
                        <div>My Monthly</div>
                    </div>
                    <div class="list-card">
                        <i class="fa-solid fa-wallet"></i>
                        <div>My Money</div>
                    </div>
                    <div class="list-card">
                        <i class="fa-solid fa-gift"></i>
                        <div>My Reward</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="chat-container">
        <div class="button-chat">
            <i class="fa-brands fa-rocketchat"></i>
            <div>Chat</div>
        </div>
        <section>
            <div class="live-chat">
                <div class="header-chat">
                    <div>Live Chat</div>
                    <i id="close-chat" class="fa-solid fa-xmark"></i>
                </div>
                <div class="user-online">
                    <i class="fa-solid fa-user"></i>
                    <div id="online-count"></div>
                </div>
                <div class="main-chat">
                    <ul id="messages"></ul>
                    <form id="form" action="">
                        <input type="text" id="m" autocomplete="off" /><button><i class="fa-solid fa-paper-plane"></i></button>
                    </form>
                </div>
            </div>
        </section>
    </div>
    <script>
        function main(){
            document.getElementById("barList").style.display = "block";
            document.getElementById("account-list").style.display = "block";
        }
        function hide(){
            document.getElementById("barList").style.display = "none";
            document.getElementById("account-list").style.display = "none";
        }

        function setColor(){
            document.getElementById("color").style.color = "#cfcfcf";
        }
        function unsetColor(){
            document.getElementById("color").style.color = "#030303";
        }
        function setColor1(){
            document.getElementById("color1").style.color = "#cfcfcf";
        }
        function unsetColor1(){
            document.getElementById("color1").style.color = "#030303";
        }
        function setColor2(){
            document.getElementById("color2").style.color = "#cfcfcf";
        }
        function unsetColor2(){
            document.getElementById("color2").style.color = "#030303";
        }
        function setColor3(){
            document.getElementById("color3").style.color = "#cfcfcf";
        }
        function unsetColor3(){
            document.getElementById("color3").style.color = "#030303";
        }
        function setColor4(){
            document.getElementById("color4").style.color = "#cfcfcf";
        }
        function unsetColor4(){
            document.getElementById("color4").style.color = "#030303";
        }
        function setColor5(){
            document.getElementById("color5").style.color = "#cfcfcf";
        }
        function unsetColor5(){
            document.getElementById("color5").style.color = "#030303";
        }
        function setColor6(){
            document.getElementById("color6").style.color = "#cfcfcf";
        }
        function unsetColor6(){
            document.getElementById("color6").style.color = "#030303";
        }
        function setColor7(){
            document.getElementById("color7").style.color = "#cfcfcf";
        }
        function unsetColor7(){
            document.getElementById("color7").style.color = "#030303";
        }
        document.addEventListener('DOMContentLoaded', function () {
            var username = '<%= username %>';
            var greetingMessageElement = document.getElementById('greeting-message');
            var currentTime = new Date().getHours();

            if (currentTime >= 5 && currentTime < 12) {
                greetingMessageElement.innerText = 'Good Morning, ' + username;
            } else if (currentTime >= 12 && currentTime < 18) {
                greetingMessageElement.innerText = 'Good Afternoon, ' + username;
            } else {
                greetingMessageElement.innerText = 'Good Evening, ' + username;
            }
        });

        document.addEventListener('DOMContentLoaded', function (){
            var motivationText = [
                "What's on your agenda for today?",
                "Any plans on your schedule today?",
                "What do you have lined up for today?",
                "How are you spending your day today?",
                "Any specific plans for today?",
                "What's your plan of action for today?",
                "What's in store for you today?",
                "Any activities or tasks planned for today?",
                "How are you occupying yourself today?",
                "What are your plans for the day ahead?",
                "Seize the day!",
                "Embrace challenges boldly.",
                "Pursue your passions.",
                "Achieve your goals.",
                "Stay focused, achieve.",
                "Strive for greatness.",
                "Unleash your potential.",
                "Inspire with action.",
                "Conquer your fears.",
                "Make every moment count."
            ];
            var randomMotivation = motivationText[Math.floor(Math.random() * motivationText.length)];
            document.getElementById('motivation-text').innerText = randomMotivation;
        });

        document.addEventListener('DOMContentLoaded', function (){
            var myDay = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            var myMonth = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'Desember'];
            var currentDay = new Date().getDay();
            var currentDate = new Date().getDate();
            var currentMonth = new Date().getMonth();
            var currentMyDay = myDay[currentDay];
            var currentMyMonth = myMonth[currentMonth];
            document.getElementById('day').innerText = currentMyDay;
            document.getElementById('date').innerText = currentDate;
            document.getElementById('month').innerText = currentMyMonth;
        });

        document.addEventListener('DOMContentLoaded', function () {
            const buttonChat = document.querySelector(".button-chat");
            const closeChat = document.getElementById("close-chat");
            const liveChat = document.querySelector("section");

            buttonChat.addEventListener("click", () => liveChat.classList.add("livechat-active"));
            closeChat.addEventListener("click", () => liveChat.classList.remove("livechat-active"));
        });

        function confirmLogout() {
            const logoutConfirmed = window.confirm("Are you sure you want to logout?");
            if (logoutConfirmed) {
                fetch("/logout", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({}),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        window.location.href = "/";
                    } else {
                        alert("Logout failed!");
                    }
                })
                .catch(error => {
                    console.error("Error during logout:", error);
                    alert("Logout failed");
                });
            } else {
                window.location.href = "/dashboard";
            }
        }   
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.4/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script>
        const socket = io();
        const username = '<%= username %>';

        socket.emit('login', username);

        $('form').submit(function() {
            var inputValue = $('#m').val();

            if (inputValue.trim() === "") {
                return false;
            }
            socket.emit('chat', { message: inputValue, username: username });
            $('#m').val('');
            return false;
        });

        socket.on('chat', function(data) {
            var chatUser = data.username;
            var chatText = data.message;
            var now = new Date();
            var chatTimeHours = now.getHours();
            var chatTimeMinutes = now.getMinutes();

            var listChat = $('<li>');
            var component1 = $('<div class="username-chat">').text(chatUser);
            var component2 = $('<div class="chat-text">').text(chatText);
            var component3 = $('<div class="chat-time">').text(chatTimeHours + ':' + (chatTimeMinutes < 10 ? '0' : '') + chatTimeMinutes);
            
            listChat.append(component1, component2, component3);
            $('#messages').append(listChat);
            var lastChatList = $('#messages li:last')[0];

            lastChatList.scrollIntoView({ behavior: "smooth", block:"end", inline:"nearest"});
        });

        socket.on('userStatus', ({ username, online }) => {
            $('#messages').append($('<li>').text(`${username} is ${online ? 'online' : 'offline'}`));
        });

        socket.on('updateUserCount', (count) => {
            let sumCount = count + 1;
            $('#online-count').text(sumCount);
        });

        window.addEventListener('beforeunload', () => {
            socket.emit('logout', username);
        })
    </script>
</body>
</html>